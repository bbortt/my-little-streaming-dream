language: java
dist: trusty
jdk: openjdk11

sudo: false
install: true

notifications:
  email: false

services:
  - docker

addons:
  sonarcloud:
    organization: "bbortt-github"
    token:
      secure: "PRvvKTHDm6DDqo+IgrgSPGWDFuTfp3ZMygSZC2iAGjkKhsdLEkwd0AF2bUp8TcSwwaRqXGGVQ/H4BjxFbB9CgFp1IwLeYM6nvMGp9V6FCg61PGeh584uxb9QDz68K8/HdLkOyA7LwnBzn6TYlxd9mTdrQ+/COWrXX+t9pRlSgBY8XI3Z4mdE9U63dZ+6dnKycnBmnAQGhcz+FW5PncSLevMLoqgtU8N6IBq3wJ2r1jUksiKGpyXzhTRLG0Uhk+n13bvHhGS10JWPHndjOSCrB5LYnokq0THqaUQX5JM2o+8Ym0jnTzeXAO3tQzN4/rDJjK/CEmDuh8NWgLZD/hnHaUaXQpfC2EJfJ9NfuQVLWdtheBNrd4mtd/vQ9n42dSnNCunJsKl6f1QvbgpDa9c8fZWu160U4Eu4TM58gd/QAap1xSFpfEggf/BwU8eadYqjJuLghIYkD+yGdRYuFYrmeqdfXAr+YhGwZAqqaubhpTszw8Y4G4rK5g9hf8IZ1SmbIEWH1F3HoGBhghBsBSnX5XCHh+YcOdPDBg70BiajP0cElDUSXMLfPZeXxvw5wzT2KdoL83+Ghv5uofVeS2bTP0wWbe73M+rvPDAyRMHegMT8HB6friJi8JT3oaJQVspck/GP3lsgg+tc0hBa3CT0k608zvwWF718TtgyG2qZYp0="

env:
  global:
    - secure: "e3I+7pQq9aoAQwG6F5jaEmflB+cH2jUceDKbfq+SGil8QsMHyzfVgt/xMGHfAsRVRK8laz6MPdrxUoIuQK7ZnQyoiKRkDz5wftcZiEa8foRh2ck1rGphejjMbofCaal8MWImRyjFaXWDdPgOjYRs+Xd346NGjzvLvaCB6TfZLo+tSzKnKpuSRxfkSkX6k1Q0+TPJdyqDRHZp5MUPC68IVxcVBacikEmvV4o5X7aprAbnmSWw05Ep/jLEUHXOLd6xeHPB88TT0xtGf6I09DZqztnXCfsSjwinefX5uxjUA+M7boDOqViDuG4pA76xGL/1LbLL6HUrpn+IgNsuOGN3G49Luf8Ly93WSZ021DMj8OETZLIXIiG3eNaH3ThCbBwgSfg3d1LCFgfhSRgCvjYdvkd9AIddjJNHEJwsHcIqHDqH6bVkGtBFwSoLfl8aUhXXpZq+2vI+te8dc7Hi58RC1+moxdBme4RZJXpFH31PGImrs0fyHQYccH+kChTacDz57sJku06pM57bXOKNjKT9mnU0GvsqG3PEWT8k/0y2/ICRQpM0YhfExQv/OMos3mS7e4yhRc9aQprhcXwZg5imDRrY23H2JGqox8mMbf34wZGlfxaoLbnrxLVS2rXWYsw2jBqg8Rah3uKlowWoca5nCvm4bFnYBTh6NPack1L+Zvk="
    # ^^ GITHUB_USERNAME
    - secure: "fbdQh3aAtENsHytTELgYlGaD75TAV+AI9KuRoQ2jsU1xH4BHIDsTuj/6wyH1ctagwL+tJ8r1RuaT9Y8FKyyyTUQjY1dIzKmmk1o2hjeVkJM6HnpbXKWZGPRtsKV1+88TpdejNRkenoOzXTurL5wIiRVigGb6dvshhXpA++78oVbfxwrW6V+1msBdK9J5eOjp+HvI1E1sAlRwtnS5V/g4dwcFwpo71h9bUiwm80IsJLDcsHpQ7xaKbCEPL8gElrKNkT2/19zvkyWPqCgh01JFoPc8aq8GBRYdNHImnz9WzSdVCI3O6VzjAlnMtU4iZ9p25EjX5amDxhl5MDza9az/nYaz+fiTm2AO395qrmjtyU3GTegtM6yHaFo0Op3c/84sxDi9I7L9tMu7hnZCKz4Fu/rHIJfWcA6FMsDnEe4u7GssX8Nqh+h4iBTQmanx0vGGXtykJ3vOVNCa8CliJTArgse+2yr2NFKSO4ocs/hvBzhW/ws0v/pyHquN4Yze6NyLAj++EKjfCshjEnRRvubbbsTIF4QLY6chBieQpY7fuTiBRZhCrBQ7fP/ainkFdQeJQDWxE7jdBXvdxVTGQrBKcj8TzhmiI4Fhej634cYxsAuOXTw/EF1PKoZKXQiM29OYYgp6ITwZQ0GhORYRgE0eap3wZnI9tdUGo1Xxz6y4wCM="
    # ^^ GITHUB_EMAIL
    - secure: "DfpoofvvNXPCUx5aQhzdsX6cK0qI3Sy6ym3+nh6hV1ThsHJtHCMu1SgIp3EkdmKoGsBXgpmzxG/+lM3jH6i2FATO4CSldM46kTMmovz+0Qjj3MBufOHKvLpZqGYoeXIcH7F+w3biRPdZ7I5j+I8PEeMJiceLlIUwfT2HF98vABpbRwb/0uOpVkojRFjGvLV0JGDw1RzN0O37s4qPgmInSIw291SDu0UC8QVgthlPyTmahTt2Rm+SAeJaquuS/t7jBnlmqxDZanTBeTS6fdUiZqB6ocXRd68pfgwc/7TyNr/Gp+FDPnAjSdWccSmvut09mncPWq3F9QOw0jvrEbeCrJu3e7iHXluj3lsFqjVS5S8W/6XsWPtmkbvAQRUFLKLUntHK66VjXFINNWo0j6Zw4KJ9eQ0P3+wezbAHNeejMQhsl2jMflIPtA6ccM/AmOus2FGqAJPtOaFdueXSPHPiry8HhARLMrAVs6lEvwknwjiyijOdSAUWWVSwg4kj2FJTdMyLq1jtZ2FrY7+dWyLpIQ18fzxK5yzZaFMnHpHHqIftu4IRJRywVGPB7OQPl1hOgH+ZoXlKEk1zNC6bxa7E/Wn0FaPtcqYTvFm93MLsitTAKrxBZ7BhLO8elsnbYAcl2XJXNHur5nZrMRxYzHzpbhOaOeA5lRKigrAumpNAxks="
    # ^^ GITHUB_TOKEN
    - secure: "CmHwlof3qaSj7ufDgdMiAtguFGVsGlwgV/GwFrfBJkdMse+kb/QLG2oTacs/CNBWhYiUCU3SIoJlTDldUct+f3pjMbOyvgGk7SiHUgKSFu6Aaun3LDVbW4XcRRCjstr9nur6lp/w++EvWvCD9wUMkv/fALK0Vii1N1mAbbjRFzsFy1mqB9Ss4k5owXsjqcUIjbiGiEnHdEa7W++5QugoVRa7K7ogQJ5IDAIcoBxaAxGz4Wc+8I3hx0z0tWlOKy2ohU/yQNUBASj0LqZvcZxVRYAZBzDA40soT26k1wVFm3vQiJ9tDJQbykXDzAAa62807PzzWFSSUXz0cxVydJsNhMBNgS8/knsuS/z8dQcEzy3hQfq4nZ5H3J2PHBjIdHuAucayRCaIYhsTPySlLJHbxFyT7Ffd26Pj3/AgehRpr2s9iGAtO6EA620VPU2UdXp8FwaPJ9dxJOdHRcdT+LYA7Hpd8Nr/+GOqLK7tzQ6cqDH89mfw66Dzqb05vemMzLY30UkiQTtVvy1eq0D6ukl3josfKGX74ncNXVhWgyXYCZr/ppvsOCiYT5dIUVVC/j1JdfgNWiVd0jj84OOFFe12r3wf8bx6UL7PdLMp6ABY4evyHhtb6uP+u4PBtDYWyb9M+QEfsizGsiHaDmJFiE4ah1yDVQuxDND/z1/qRCDCGHI="
    # ^^ DOCKER_USERNAME
    - secure: "hZ0+KC8Ih6HUTl6A1yVTlXDQd5CfAIqfVLhQa1M0U/yKSg6hDiapRUMm/CvXAeWkT842i/Ja0UuopXz+BRIqoWU4QbCDDO5hvwQZ7lQUeW4z5AgDZMYeEhahbUiHbsa0G7vg6Bfs2iUud1GSZmMDYVPJdiBJx8SuQBnrIc8teKoroYSpBCbxBi1HuNBGYv9MYs3mESv3PAyZlcBJE2q6m2fMElsgKI92XTJfl+LMVd7ldruBfGO86N4dmFdyFeOuofkHtMnLjB10W3FujRCNQ+CcVrEYmHCzICFSUWeSpI8ItD6f0ZDw+IOxcdBGEOAJqp5qZn7V3y/LjWSX9Umo74P32ncoErjz4GID6YiWyo5mvG75peT3zfcGvYuf9DU/3NTl/Gp9bEoJYbaT9epGS04aEdGtpxTiHCh2DoqIWcpzxdzOler0BtERvpHcpeAdYY7+ID5b+tyuOT1DUVO2epb/2q5OtGcIFF8fAvprYGeAPhM3lcKbiXaNfNZZ+8usFBJ4GlyvLGiMKF5rZ6F/OCxcIYLJRiBGhLgcREMcYUTNKJITi4a0btgZyHLNWVsrXlG5cEgYZkFdvCqDVqiiWDp/Zzy/wyeoqGJksOC8MfKcSWW9CmUKmvUg2xDhrGtdYUuxuMnmJ7l5TgQl7bNYlvede7liQYIFKtw/Yi8X9NE="
    # ^^ DOCKER_PASSWORD

before_script:
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin

script:
  - ./gradlew dependencyUpdates
  - ./gradlew -Pversion=$TRAVIS_BUILD_NUMBER --no-daemon -i build sonarqube

after_success:
  - bash <(curl -s https://codecov.io/bash)
  - .travis/docker_build_all.sh $TRAVIS_BUILD_NUMBER

before_deploy:
  - .travis/git_tag_and_push.sh

deploy:
  - provider: script
    script: .travis/docker_push_all.sh $TRAVIS_BUILD_NUMBER

    on:
      repo: bbortt/qdrakeboo
      branch: master

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - $HOME/.sonar/cache
